# ER-диаграмма базы данных системы контроля доступа

## Диаграма:

![Диаграма базы данных]()

## Пояснения и дополнительные детали:

* **Типы данных и ключи:**

    * Использованы `UUID` в качестве первичных ключей для лучшей масштабируемости и безопасности (сравнительно с последовательными `INT`).

    * `embedding_vector` имеет тип `bytea` для хранения бинарных данных вектора (массива чисел `float32`). В качестве альтернативы можно использовать специализированные расширения PostgreSQL для векторного поиска (например, `pgvector`), тогда тип будет `vector(512)`.

    * `photo_hash` нужен для предотвращения добавления дубликатов одного и того же фото для одного сотрудника.

* **Связи (Cardinality):**

    * **Один ко многим (1:N):**

        * `employees` to `face_embeddings`: Один сотрудник может иметь несколько эталонных векторов (например, с разных фото или разных версий модели).

        * `gates` to `cameras`: На одной проходной может быть несколько камер.

        * `departments` to `employees`: В одном отделе работает много сотрудников.

    * **Один к одному (1:1) фактически:**

        * `cameras` to `access_events`: Событие доступа записывается с одной конкретной камеры.

* **Важные моменты для истории (access_events):**

    * Поля `full_name` и `department_name` дублируются из таблиц `employees` и `departments`. Это критически важно для аудита и отчетности. Если сотрудника переведут в другой отдел или изменят его ФИО, исторические записи о проходах должны остаться неизменными и отражать ситуацию на момент события.

    * `employee_id` может быть `NULL` — это случай, когда система совсем не опознала человека (`unknown`).

    * `access_result`:

        * `granted` — доступ разрешен системой.

        * `denied` — доступ отклонен системой или охранником.

        * `override` — доступ был разрешен вручную через администратора (например, забыл пропуск).

* **Безопасность и производительность:**

    * На таблицу `access_events` будут ложиться большие нагрузки (запись каждого прохода). Необходимо предусмотреть:

        * **Индексы**: На `event_timestamp`, `camera_id`, `employee_id`.

        * **Партиционирование:** Разделение таблицы по диапазонам дат (например, по месяцам) для упрощения управления и запросов к историческим данным.

    * Таблица `face_embeddings` содержит конфиденциальную биометрическую информацию. Необходимо строгое разграничение доступа и шифрование этой таблицы на уровне базы данных.